// backend/db.js
const { Pool } = require("pg");

function makePool() {
  const cs = process.env.DATABASE_URL;
  if (!cs) throw new Error("DATABASE_URL is missing");

  // Neon needs SSL; sslmode=require in the URL is not always enough for node-postgres
  const ssl = { rejectUnauthorized: false };

  return new Pool({ connectionString: cs, ssl });
}

const pool = makePool();

async function query(text, params) {
  return pool.query(text, params);
}

module.exports = { pool, query };